# A股财务分析系统 - 使用指南

## 🎯 核心功能

### 1. 财报审计意见
检查公司审计意见是否为"标准无保留意见"，这是最基本的财务健康指标。

### 2. 三大核心指标分析

#### 2.1 资产负债率
- **含义**：公司用多少"借来的钱"在运营
- **计算**：总负债 / 总资产 × 100%
- **标准**：因行业而异
  - 地产：<60%较健康
  - 科技：>50%需警惕  
  - 消费：越低越安全（如茅台22.3%）

#### 2.2 毛利率
- **含义**：产品/服务的基本赚钱能力和护城河强度
- **计算**：（营业收入 − 营业成本）/ 营业收入 × 100%
- **标准**：因行业而异
  - 制造业：25%可能很优秀
  - 消费行业：<40%需警惕
  - 品牌溢价强：通常60%+（如瑞幸59%，星巴克68%）

#### 2.3 经营活动现金流量净额
- **核心两问**：
  1. 连续3-5年为正吗？
  2. 是否持续≥净利润？
- **含义**：公司是否真的赚到"真金白银"
- **案例**：格力2022年经营净现流298亿 > 净利润245亿，多53亿

## 🚀 快速开始

### 步骤1：安装依赖
```bash
pip install -r requirements.txt
```

### 步骤2：配置Token
1. 访问 https://tushare.pro/register 注册账号
2. 访问 https://tushare.pro/user/token 获取Token
3. **完成实名认证**（必需，获得120积分）
4. 复制 `settings.example.py` 为 `settings.py`
5. 填入你的真实Token

### 步骤3：运行应用
```bash
streamlit run app.py
```

访问：http://localhost:8501

## 📊 使用流程

### 1. 选择行业（侧边栏）
系统支持多种行业分类，不同行业使用不同的评分标准：
- 消费（如茅台）
- 科技
- 地产
- 制造业
- 品牌/平台
- 金融
- 其他

### 2. 设置分析年份
- 开始年：如2018
- 结束年：如2023
- 可自由输入任何年份

### 3. 输入股票代码
支持两种格式：
- **6位代码**：600519（自动识别并补全.SH或.SZ）
- **完整代码**：600519.SH

### 4. 查看分析结果

#### 公司基本信息
- 公司全称
- 董事长
- 主要业务及产品
- 经营范围

#### 综合评分
- 平均分（满分3.00）
- 最新年分（满分3）
- 红旗年数
- 分析年限

#### 审计意见
- 报告期
- 是否标准无保留意见
- 会计师事务所

#### 三大核心指标
每个指标都会显示：
- 最新年份数值
- 是否达标（✅/❌）
- 行业标准说明

#### 年度财务健康度
每年显示：
- 年度得分（0-3分）🟢🟢🟢
- 资产负债率（✅/❌）
- 毛利率（✅/❌）
- 经营现金流（✅/❌）
- 现金流vs净利润对比

#### 图表展示
- 资产负债率趋势图
- 毛利率趋势图
- 经营现金流趋势图
- 年度得分趋势图

#### 年度总结
- 财务健康度评级（优秀/良好/一般/较差）
- **最关键**：公司到底赚没赚到钱？
  - 真金白银，赚到手了！✅
  - 基本赚钱，但要注意收款 🟡
  - 收款能力不稳定 ⚠️
  - 可能是纸上富贵 🚨

## 💾 缓存机制

### 自动缓存
- 查询结果自动缓存24小时
- 保存在 `data/cache/` 目录
- 即使关闭浏览器，缓存依然有效

### 缓存优势
- **第1次查询**：约0.5秒（调用API）
- **第2次查询**：<0.1秒（使用缓存）
- **节省API调用**：24小时内无限次免费查询

### 缓存管理
侧边栏提供缓存统计和管理：
- 查看有效/过期缓存数量
- 一键清理过期缓存
- 一键清空全部缓存

## ⚙️ API设置

### 延迟配置
根据你的Tushare积分等级选择：

| 积分 | 等级 | 推荐延迟 | 查询耗时 |
|------|------|---------|---------|
| 0-119 | 未认证 | 31秒 | ~2分钟 |
| 120-599 | 注册用户 | 13秒 | ~1分钟 |
| **600-4999** | **中级用户** | **0.1秒** | **~0.5秒** ✅ |
| 5000+ | 高级用户 | 0秒 | ~0.3秒 |

### 为什么需要延迟？
- Tushare有API频率限制
- 每次查询需要调用5次API：
  1. 公司基本信息
  2. 审计意见
  3. 资产负债表
  4. 利润表
  5. 现金流量表

### 推荐配置
- **2000+积分用户**：使用0.1秒延迟（默认）
- **低积分用户**：等待时间较长，但可以通过缓存机制减少等待

## 📈 评分标准

### 年度得分（0-3分）
每年根据三大指标计算：
- ✅ 资产负债率达标：+1分
- ✅ 毛利率达标：+1分
- ✅ 经营现金流为正：+1分

### 评级标准
- **3分** 🟢🟢🟢 - 优秀
- **2分** 🟢🟢⚪ - 良好
- **1分** 🟢⚪⚪ - 一般
- **0分** 🔴🔴🔴 - 较差

### 红旗年份
得分<2的年份被标记为"红旗年份"，需要特别关注。

## 🕘 历史记录

系统会自动记录每次分析：
- 查询时间
- 股票代码
- 行业分类
- 评分结果
- 年份范围

历史记录保存在 `data/analysis_history.json`

## ❓ 常见问题

### Q: 提示"IP数量超限"怎么办？
**A:** 
1. 等待1-2分钟后重试
2. 检查你的积分等级
3. 使用缓存（第2次查询不消耗API）
4. 调整延迟时间

### Q: 为什么没有数据？
**A:**
1. 检查股票代码是否正确
2. 调整年份范围
3. 确认该公司在指定年份有年报
4. 开启调试模式查看详细错误

### Q: 如何提升查询速度？
**A:**
1. 提升Tushare积分（做任务、邀请好友）
2. 使用缓存机制（第2次查询秒开）
3. 调整延迟时间（根据积分等级）

### Q: 缓存什么时候过期？
**A:**
- 缓存有效期：24小时
- 过期后会自动清理
- 可以手动清除缓存强制刷新数据

## 💡 使用技巧

### 技巧1：善用缓存
- 先查询一批股票
- 后续24小时内可以随时回看，不消耗API

### 技巧2：批量分析
- 把多个股票代码记录下来
- 逐个查询并保存到历史记录
- 在历史记录中对比分析

### 技巧3：关注关键指标
- 优先看"年度总结"中的最终结论
- 重点关注"是否赚到真金白银"
- 红旗年份<1年的公司值得深入研究

## 📞 联系方式

如有问题或建议，欢迎提Issue！

